{"ast":null,"code":"var _jsxFileName = \"C:\\\\Kuliah\\\\Semester 6\\\\Topik Khusus\\\\MovieStore\\\\client\\\\src\\\\pages\\\\Public\\\\BookingPage\\\\BookingPage.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { withStyles, Grid, Container, Box } from '@material-ui/core';\nimport { getMovie, getCinemasUserModeling, getCinema, getCinemas, getShowtimes, getReservations, getSuggestedReservationSeats, setSelectedSeats, setSelectedCinema, setSelectedDate, setSelectedTime, setInvitation, toggleLoginPopup, showInvitationForm, resetCheckout, setAlert, addReservation, setSuggestedSeats, setQRCode } from '../../../store/actions';\nimport { ResponsiveDialog } from '../../../components';\nimport LoginForm from '../Login/components/LoginForm';\nimport styles from './styles';\nimport MovieInfo from './components/MovieInfo/MovieInfo';\nimport BookingForm from './components/BookingForm/BookingForm';\nimport BookingSeats from './components/BookingSeats/BookingSeats';\nimport BookingCheckout from './components/BookingCheckout/BookingCheckout';\nimport BookingInvitation from './components/BookingInvitation/BookingInvitation';\nimport jsPDF from 'jspdf';\nclass BookingPage extends Component {\n  constructor(...args) {\n    super(...args);\n    this.didSetSuggestion = false;\n    this.jsPdfGenerator = () => {\n      const {\n        movie,\n        cinema,\n        selectedDate,\n        selectedTime,\n        QRCode\n      } = this.props;\n      const doc = new jsPDF();\n      doc.setFont('helvetica');\n      doc.setFontType('bold');\n      doc.setFontSize(22);\n      doc.text(movie.title, 20, 20);\n      doc.setFontSize(16);\n      doc.text(cinema.name, 20, 30);\n      doc.text(`Date: ${new Date(selectedDate).toLocaleDateString()} - Time: ${selectedTime}`, 20, 40);\n      doc.addImage(QRCode, 'JPEG', 15, 40, 160, 160);\n      doc.save(`${movie.title}-${cinema.name}.pdf`);\n    };\n    this.onSelectSeat = (row, seat) => {\n      const {\n        cinema,\n        selectedSeats,\n        setSelectedSeats\n      } = this.props;\n      const seats = (cinema === null || cinema === void 0 ? void 0 : cinema.seats) ? [...cinema.seats.map(r => [...r])] : [];\n      if (!seats[row] || seats[row][seat] === undefined) return;\n      if (seats[row][seat] === 1) return;\n      let updatedSelectedSeats = [...selectedSeats];\n      if (seats[row][seat] === 2) {\n        seats[row][seat] = 0;\n        updatedSelectedSeats = updatedSelectedSeats.filter(([r, s]) => !(r === row && s === seat));\n      } else {\n        seats[row][seat] = 2;\n        updatedSelectedSeats.push([row, seat]);\n      }\n      setSelectedSeats(updatedSelectedSeats);\n    };\n    this.onGetReservedSeats = () => {\n      const {\n        reservations,\n        cinema,\n        selectedDate,\n        selectedTime\n      } = this.props;\n      if (!(cinema === null || cinema === void 0 ? void 0 : cinema.seats)) return [];\n      const newSeats = cinema.seats.map(row => [...row]);\n      const filteredReservations = reservations.filter(reservation => new Date(reservation.date).toLocaleDateString() === new Date(selectedDate).toLocaleDateString() && reservation.startAt === selectedTime);\n      filteredReservations.flatMap(reservation => reservation.seats).forEach(([row, seat]) => {\n        if (newSeats[row]) newSeats[row][seat] = 1;\n      });\n      return newSeats;\n    };\n    this.onGetSuggestedSeats = (seats, suggestedSeats) => {\n      const {\n        numberOfTickets,\n        positions\n      } = suggestedSeats;\n      const positionsArray = Object.entries(positions).sort((a, b) => b[1] - a[1]);\n      if (positionsArray.every(position => position[1] === 0)) return;\n      const step = Math.round(seats.length / 3);\n      for (let [zone] of positionsArray) {\n        let indexArr = zone === 'front' ? [0, step] : zone === 'center' ? [step, step * 2] : [step * 2, seats.length];\n        const suggested = this.checkSeats(indexArr, seats, numberOfTickets);\n        if (suggested) {\n          this.getSeat(suggested, seats, numberOfTickets);\n          break;\n        }\n      }\n    };\n    this.checkSeats = (indexArr, seats, numberOfTickets) => {\n      for (let i = indexArr[0]; i < indexArr[1]; i++) {\n        for (let j = 0; j <= seats[i].length - numberOfTickets; j++) {\n          if (seats[i].slice(j, j + numberOfTickets).every(seat => !seat)) {\n            return [i, j];\n          }\n        }\n      }\n      return null;\n    };\n    this.getSeat = (suggested, seats, numberOfTickets) => {\n      const {\n        setSuggestedSeats\n      } = this.props;\n      const seatsToSet = [];\n      for (let i = suggested[1]; i < suggested[1] + numberOfTickets; i++) {\n        seatsToSet.push([suggested[0], i]);\n      }\n      setSuggestedSeats(seatsToSet);\n    };\n    this.onChangeCinema = event => this.props.setSelectedCinema(event.target.value);\n    this.onChangeDate = date => this.props.setSelectedDate(date);\n    this.onChangeTime = event => this.props.setSelectedTime(event.target.value);\n  }\n  componentDidMount() {\n    const {\n      user,\n      match,\n      getMovie,\n      getCinemas,\n      getCinemasUserModeling,\n      getShowtimes,\n      getReservations,\n      getSuggestedReservationSeats\n    } = this.props;\n    getMovie(match.params.id);\n    user ? getCinemasUserModeling(user.username) : getCinemas();\n    getShowtimes();\n    getReservations();\n    if (user) getSuggestedReservationSeats(user.username);\n  }\n  componentDidUpdate(prevProps) {\n    const {\n      selectedCinema,\n      selectedDate,\n      getCinema\n    } = this.props;\n    if (selectedCinema && prevProps.selectedCinema !== selectedCinema || selectedCinema && prevProps.selectedDate !== selectedDate) {\n      getCinema(selectedCinema);\n    }\n  }\n  async checkout() {\n    const {\n      selectedSeats,\n      isAuth,\n      toggleLoginPopup,\n      addReservation,\n      setQRCode,\n      getReservations,\n      showInvitationForm,\n      movie,\n      cinema,\n      selectedDate,\n      selectedTime,\n      user,\n      setAlert\n    } = this.props;\n\n    // Validasi awal\n    if (!selectedSeats.length) {\n      setAlert('Silakan pilih kursi terlebih dahulu.', 'error');\n      return;\n    }\n    if (!isAuth) {\n      toggleLoginPopup();\n      return;\n    }\n    if (!(user === null || user === void 0 ? void 0 : user.username) || !(user === null || user === void 0 ? void 0 : user.phone)) {\n      setAlert('Profil tidak lengkap. Pastikan username dan nomor HP terisi.', 'error');\n      return;\n    }\n    if (!(movie === null || movie === void 0 ? void 0 : movie._id) || !(cinema === null || cinema === void 0 ? void 0 : cinema._id) || !selectedDate || !selectedTime) {\n      setAlert('Data booking tidak lengkap.', 'error');\n      return;\n    }\n    const total = selectedSeats.length * (cinema.ticketPrice || 0);\n    const payload = {\n      username: user.username,\n      phone: user.phone,\n      movieId: movie._id,\n      cinemaId: cinema._id,\n      date: selectedDate,\n      startAt: selectedTime,\n      seats: selectedSeats,\n      ticketPrice: cinema.ticketPrice,\n      total: total\n    };\n    try {\n      console.log('Booking payload:', payload);\n      const res = await addReservation(payload);\n      if ((res === null || res === void 0 ? void 0 : res.status) === 'success') {\n        setQRCode(res.data.QRCode);\n        await getReservations();\n        showInvitationForm();\n      } else {\n        console.error('Booking failed', res);\n        setAlert(`Booking gagal: ${(res === null || res === void 0 ? void 0 : res.message) || 'Unknown error'}`, 'error');\n      }\n    } catch (err) {\n      console.error('Booking error:', err);\n      setAlert(`Terjadi kesalahan sistem: ${err.message}`, 'error');\n    }\n  }\n  bookSeats() {\n    const {\n      cinema\n    } = this.props;\n    if (!(cinema === null || cinema === void 0 ? void 0 : cinema.seats)) return [];\n    return cinema.seats.flatMap((row, rowIndex) => row.map((seat, seatIndex) => seat === 2 ? [rowIndex, seatIndex] : null).filter(Boolean));\n  }\n  onFilterCinema() {\n    const {\n      cinemas,\n      showtimes,\n      selectedCinema,\n      selectedTime\n    } = this.props;\n    const initialReturn = {\n      uniqueCinemas: [],\n      uniqueTimes: []\n    };\n    if (!showtimes || !cinemas) return initialReturn;\n    const uniqueCinemasId = showtimes.filter(showtime => selectedTime ? showtime.startAt === selectedTime : true).map(showtime => showtime.cinemaId).filter((value, index, self) => self.indexOf(value) === index);\n    const uniqueCinemas = cinemas.filter(cinema => uniqueCinemasId.includes(cinema._id));\n    const uniqueTimes = showtimes.filter(showtime => selectedCinema ? selectedCinema === showtime.cinemaId : true).map(showtime => showtime.startAt).filter((value, index, self) => self.indexOf(value) === index).sort((a, b) => new Date(`1970/01/01 ${a}`) - new Date(`1970/01/01 ${b}`));\n    return {\n      ...initialReturn,\n      uniqueCinemas,\n      uniqueTimes\n    };\n  }\n  render() {\n    const {\n      classes,\n      user,\n      movie,\n      cinema,\n      showtimes,\n      selectedSeats,\n      selectedCinema,\n      selectedDate,\n      selectedTime,\n      showLoginPopup,\n      toggleLoginPopup,\n      showInvitation,\n      invitations,\n      setInvitation,\n      resetCheckout,\n      suggestedSeats,\n      suggestedSeat\n    } = this.props;\n    const {\n      uniqueCinemas,\n      uniqueTimes\n    } = this.onFilterCinema();\n    let seats = this.onGetReservedSeats();\n    if (suggestedSeats && selectedTime && !suggestedSeat.length) {\n      this.onGetSuggestedSeats(seats, suggestedSeats);\n    }\n    if (suggestedSeat.length && !this.didSetSuggestion) {\n      suggestedSeat.forEach(([row, seat]) => {\n        if (seats[row]) seats[row][seat] = 3;\n      });\n      this.didSetSuggestion = true;\n    }\n    const seatsAvailable = seats.flat().filter(seat => seat === 0).length;\n    return /*#__PURE__*/React.createElement(Container, {\n      maxWidth: \"xl\",\n      className: classes.container,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Grid, {\n      container: true,\n      spacing: 2,\n      style: {\n        height: '100%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(MovieInfo, {\n      movie: movie,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      lg: 9,\n      xs: 12,\n      md: 12,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(BookingForm, {\n      cinemas: uniqueCinemas,\n      times: uniqueTimes,\n      showtimes: showtimes,\n      selectedCinema: selectedCinema,\n      selectedDate: selectedDate,\n      selectedTime: selectedTime,\n      onChangeCinema: this.onChangeCinema,\n      onChangeDate: this.onChangeDate,\n      onChangeTime: this.onChangeTime,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 13\n      }\n    }), showInvitation && !!selectedSeats.length && /*#__PURE__*/React.createElement(BookingInvitation, {\n      selectedSeats: selectedSeats,\n      sendInvitations: this.sendInvitations,\n      ignore: resetCheckout,\n      invitations: invitations,\n      onSetInvitation: setInvitation,\n      onDownloadPDF: this.jsPdfGenerator,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 15\n      }\n    }), cinema && selectedCinema && selectedTime && !showInvitation ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(BookingSeats, {\n      seats: seats,\n      onSelectSeat: (indexRow, index) => this.onSelectSeat(indexRow, index),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(BookingCheckout, {\n      user: user,\n      ticketPrice: cinema.ticketPrice,\n      seatsAvailable: seatsAvailable,\n      selectedSeats: selectedSeats.length,\n      onBookSeats: () => {\n        console.log('Checkout clicked');\n        this.checkout();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 336,\n        columnNumber: 17\n      }\n    })) : /*#__PURE__*/React.createElement(Box, {\n      textAlign: \"center\",\n      color: \"white\",\n      mt: 2,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 15\n      }\n    }, \"Seats not available.\"))), /*#__PURE__*/React.createElement(ResponsiveDialog, {\n      id: \"Edit-cinema\",\n      open: showLoginPopup,\n      handleClose: () => toggleLoginPopup(),\n      maxWidth: \"sm\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(LoginForm, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 11\n      }\n    })));\n  }\n}\nBookingPage.propTypes = {\n  className: PropTypes.string,\n  classes: PropTypes.object.isRequired,\n  history: PropTypes.object.isRequired\n};\nconst mapStateToProps = ({\n  authState,\n  movieState,\n  cinemaState,\n  showtimeState,\n  reservationState,\n  checkoutState\n}, ownProps) => ({\n  isAuth: authState.isAuthenticated,\n  user: authState.user,\n  movie: movieState.selectedMovie,\n  cinema: cinemaState.selectedCinema,\n  cinemas: cinemaState.cinemas,\n  showtimes: showtimeState.showtimes.filter(showtime => showtime.movieId === ownProps.match.params.id),\n  reservations: reservationState.reservations,\n  selectedSeats: checkoutState.selectedSeats,\n  suggestedSeat: checkoutState.suggestedSeat,\n  selectedCinema: checkoutState.selectedCinema,\n  selectedDate: checkoutState.selectedDate,\n  selectedTime: checkoutState.selectedTime,\n  showLoginPopup: checkoutState.showLoginPopup,\n  showInvitation: checkoutState.showInvitation,\n  invitations: checkoutState.invitations,\n  QRCode: checkoutState.QRCode,\n  suggestedSeats: reservationState.suggestedSeats\n});\nconst mapDispatchToProps = {\n  getMovie,\n  getCinema,\n  getCinemasUserModeling,\n  getCinemas,\n  getShowtimes,\n  getReservations,\n  getSuggestedReservationSeats,\n  addReservation,\n  setSelectedSeats,\n  setSuggestedSeats,\n  setSelectedCinema,\n  setSelectedDate,\n  setSelectedTime,\n  setInvitation,\n  toggleLoginPopup,\n  showInvitationForm,\n  resetCheckout,\n  setAlert,\n  setQRCode\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(BookingPage));","map":{"version":3,"names":["React","Component","PropTypes","connect","withStyles","Grid","Container","Box","getMovie","getCinemasUserModeling","getCinema","getCinemas","getShowtimes","getReservations","getSuggestedReservationSeats","setSelectedSeats","setSelectedCinema","setSelectedDate","setSelectedTime","setInvitation","toggleLoginPopup","showInvitationForm","resetCheckout","setAlert","addReservation","setSuggestedSeats","setQRCode","ResponsiveDialog","LoginForm","styles","MovieInfo","BookingForm","BookingSeats","BookingCheckout","BookingInvitation","jsPDF","BookingPage","constructor","args","didSetSuggestion","jsPdfGenerator","movie","cinema","selectedDate","selectedTime","QRCode","props","doc","setFont","setFontType","setFontSize","text","title","name","Date","toLocaleDateString","addImage","save","onSelectSeat","row","seat","selectedSeats","seats","map","r","undefined","updatedSelectedSeats","filter","s","push","onGetReservedSeats","reservations","newSeats","filteredReservations","reservation","date","startAt","flatMap","forEach","onGetSuggestedSeats","suggestedSeats","numberOfTickets","positions","positionsArray","Object","entries","sort","a","b","every","position","step","Math","round","length","zone","indexArr","suggested","checkSeats","getSeat","i","j","slice","seatsToSet","onChangeCinema","event","target","value","onChangeDate","onChangeTime","componentDidMount","user","match","params","id","username","componentDidUpdate","prevProps","selectedCinema","checkout","isAuth","phone","_id","total","ticketPrice","payload","movieId","cinemaId","console","log","res","status","data","error","message","err","bookSeats","rowIndex","seatIndex","Boolean","onFilterCinema","cinemas","showtimes","initialReturn","uniqueCinemas","uniqueTimes","uniqueCinemasId","showtime","index","self","indexOf","includes","render","classes","showLoginPopup","showInvitation","invitations","suggestedSeat","seatsAvailable","flat","createElement","maxWidth","className","container","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","spacing","style","height","item","lg","xs","md","times","sendInvitations","ignore","onSetInvitation","onDownloadPDF","Fragment","indexRow","onBookSeats","textAlign","color","mt","open","handleClose","propTypes","string","object","isRequired","history","mapStateToProps","authState","movieState","cinemaState","showtimeState","reservationState","checkoutState","ownProps","isAuthenticated","selectedMovie","mapDispatchToProps"],"sources":["C:/Kuliah/Semester 6/Topik Khusus/MovieStore/client/src/pages/Public/BookingPage/BookingPage.js"],"sourcesContent":["import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { withStyles, Grid, Container, Box } from '@material-ui/core';\r\nimport {\r\n  getMovie,\r\n  getCinemasUserModeling,\r\n  getCinema,\r\n  getCinemas,\r\n  getShowtimes,\r\n  getReservations,\r\n  getSuggestedReservationSeats,\r\n  setSelectedSeats,\r\n  setSelectedCinema,\r\n  setSelectedDate,\r\n  setSelectedTime,\r\n  setInvitation,\r\n  toggleLoginPopup,\r\n  showInvitationForm,\r\n  resetCheckout,\r\n  setAlert,\r\n  addReservation,\r\n  setSuggestedSeats,\r\n  setQRCode\r\n} from '../../../store/actions';\r\nimport { ResponsiveDialog } from '../../../components';\r\nimport LoginForm from '../Login/components/LoginForm';\r\nimport styles from './styles';\r\nimport MovieInfo from './components/MovieInfo/MovieInfo';\r\nimport BookingForm from './components/BookingForm/BookingForm';\r\nimport BookingSeats from './components/BookingSeats/BookingSeats';\r\nimport BookingCheckout from './components/BookingCheckout/BookingCheckout';\r\nimport BookingInvitation from './components/BookingInvitation/BookingInvitation';\r\nimport jsPDF from 'jspdf';\r\n\r\nclass BookingPage extends Component {\r\n  didSetSuggestion = false;\r\n\r\n  componentDidMount() {\r\n    const {\r\n      user,\r\n      match,\r\n      getMovie,\r\n      getCinemas,\r\n      getCinemasUserModeling,\r\n      getShowtimes,\r\n      getReservations,\r\n      getSuggestedReservationSeats\r\n    } = this.props;\r\n    getMovie(match.params.id);\r\n    user ? getCinemasUserModeling(user.username) : getCinemas();\r\n    getShowtimes();\r\n    getReservations();\r\n    if (user) getSuggestedReservationSeats(user.username);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const { selectedCinema, selectedDate, getCinema } = this.props;\r\n    if (\r\n      (selectedCinema && prevProps.selectedCinema !== selectedCinema) ||\r\n      (selectedCinema && prevProps.selectedDate !== selectedDate)\r\n    ) {\r\n      getCinema(selectedCinema);\r\n    }\r\n  }\r\n\r\n  jsPdfGenerator = () => {\r\n    const { movie, cinema, selectedDate, selectedTime, QRCode } = this.props;\r\n    const doc = new jsPDF();\r\n    doc.setFont('helvetica');\r\n    doc.setFontType('bold');\r\n    doc.setFontSize(22);\r\n    doc.text(movie.title, 20, 20);\r\n    doc.setFontSize(16);\r\n    doc.text(cinema.name, 20, 30);\r\n    doc.text(`Date: ${new Date(selectedDate).toLocaleDateString()} - Time: ${selectedTime}`, 20, 40);\r\n    doc.addImage(QRCode, 'JPEG', 15, 40, 160, 160);\r\n    doc.save(`${movie.title}-${cinema.name}.pdf`);\r\n  };\r\n\r\n  onSelectSeat = (row, seat) => {\r\n  const { cinema, selectedSeats, setSelectedSeats } = this.props;\r\n  const seats = cinema?.seats ? [...cinema.seats.map(r => [...r])] : [];\r\n  if (!seats[row] || seats[row][seat] === undefined) return;\r\n\r\n  if (seats[row][seat] === 1) return;\r\n\r\n  let updatedSelectedSeats = [...selectedSeats];\r\n\r\n  if (seats[row][seat] === 2) {\r\n    seats[row][seat] = 0;\r\n    updatedSelectedSeats = updatedSelectedSeats.filter(\r\n      ([r, s]) => !(r === row && s === seat)\r\n    );\r\n  } else {\r\n    seats[row][seat] = 2;\r\n    updatedSelectedSeats.push([row, seat]);\r\n  }\r\n\r\n  setSelectedSeats(updatedSelectedSeats);\r\n};\r\n\r\nasync checkout() {\r\n  const {\r\n    selectedSeats,\r\n    isAuth,\r\n    toggleLoginPopup,\r\n    addReservation,\r\n    setQRCode,\r\n    getReservations,\r\n    showInvitationForm,\r\n    movie,\r\n    cinema,\r\n    selectedDate,\r\n    selectedTime,\r\n    user,\r\n    setAlert\r\n  } = this.props;\r\n\r\n  // Validasi awal\r\n  if (!selectedSeats.length) {\r\n    setAlert('Silakan pilih kursi terlebih dahulu.', 'error');\r\n    return;\r\n  }\r\n\r\n  if (!isAuth) {\r\n    toggleLoginPopup();\r\n    return;\r\n  }\r\n\r\n  if (!user?.username || !user?.phone) {\r\n    setAlert('Profil tidak lengkap. Pastikan username dan nomor HP terisi.', 'error');\r\n    return;\r\n  }\r\n\r\n  if (!movie?._id || !cinema?._id || !selectedDate || !selectedTime) {\r\n    setAlert('Data booking tidak lengkap.', 'error');\r\n    return;\r\n  }\r\n\r\n  const total = selectedSeats.length * (cinema.ticketPrice || 0);\r\n\r\n  const payload = {\r\n    username: user.username,\r\n    phone: user.phone,\r\n    movieId: movie._id,\r\n    cinemaId: cinema._id,\r\n    date: selectedDate,\r\n    startAt: selectedTime,\r\n    seats: selectedSeats,\r\n    ticketPrice: cinema.ticketPrice,\r\n    total: total\r\n  };\r\n\r\n  try {\r\n    console.log('Booking payload:', payload);\r\n\r\n    const res = await addReservation(payload);\r\n\r\n    if (res?.status === 'success') {\r\n      setQRCode(res.data.QRCode);\r\n      await getReservations();\r\n      showInvitationForm();\r\n    } else {\r\n      console.error('Booking failed', res);\r\n      setAlert(`Booking gagal: ${res?.message || 'Unknown error'}`, 'error');\r\n    }\r\n  } catch (err) {\r\n    console.error('Booking error:', err);\r\n    setAlert(`Terjadi kesalahan sistem: ${err.message}`, 'error');\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n  bookSeats() {\r\n    const { cinema } = this.props;\r\n    if (!cinema?.seats) return [];\r\n\r\n    return cinema.seats\r\n      .flatMap((row, rowIndex) =>\r\n        row.map((seat, seatIndex) => (seat === 2 ? [rowIndex, seatIndex] : null)).filter(Boolean)\r\n      );\r\n  }\r\n\r\n  onFilterCinema() {\r\n    const { cinemas, showtimes, selectedCinema, selectedTime } = this.props;\r\n    const initialReturn = { uniqueCinemas: [], uniqueTimes: [] };\r\n    if (!showtimes || !cinemas) return initialReturn;\r\n\r\n    const uniqueCinemasId = showtimes\r\n      .filter(showtime => (selectedTime ? showtime.startAt === selectedTime : true))\r\n      .map(showtime => showtime.cinemaId)\r\n      .filter((value, index, self) => self.indexOf(value) === index);\r\n\r\n    const uniqueCinemas = cinemas.filter(cinema => uniqueCinemasId.includes(cinema._id));\r\n\r\n    const uniqueTimes = showtimes\r\n      .filter(showtime => (selectedCinema ? selectedCinema === showtime.cinemaId : true))\r\n      .map(showtime => showtime.startAt)\r\n      .filter((value, index, self) => self.indexOf(value) === index)\r\n      .sort((a, b) => new Date(`1970/01/01 ${a}`) - new Date(`1970/01/01 ${b}`));\r\n\r\n    return { ...initialReturn, uniqueCinemas, uniqueTimes };\r\n  }\r\n\r\n  onGetReservedSeats = () => {\r\n    const { reservations, cinema, selectedDate, selectedTime } = this.props;\r\n    if (!cinema?.seats) return [];\r\n\r\n    const newSeats = cinema.seats.map(row => [...row]);\r\n    const filteredReservations = reservations.filter(\r\n      reservation =>\r\n        new Date(reservation.date).toLocaleDateString() ===\r\n          new Date(selectedDate).toLocaleDateString() &&\r\n        reservation.startAt === selectedTime\r\n    );\r\n\r\n    filteredReservations\r\n      .flatMap(reservation => reservation.seats)\r\n      .forEach(([row, seat]) => {\r\n        if (newSeats[row]) newSeats[row][seat] = 1;\r\n      });\r\n\r\n    return newSeats;\r\n  };\r\n\r\n  onGetSuggestedSeats = (seats, suggestedSeats) => {\r\n    const { numberOfTickets, positions } = suggestedSeats;\r\n    const positionsArray = Object.entries(positions).sort((a, b) => b[1] - a[1]);\r\n\r\n    if (positionsArray.every(position => position[1] === 0)) return;\r\n\r\n    const step = Math.round(seats.length / 3);\r\n    for (let [zone] of positionsArray) {\r\n      let indexArr =\r\n        zone === 'front' ? [0, step] : zone === 'center' ? [step, step * 2] : [step * 2, seats.length];\r\n      const suggested = this.checkSeats(indexArr, seats, numberOfTickets);\r\n      if (suggested) {\r\n        this.getSeat(suggested, seats, numberOfTickets);\r\n        break;\r\n      }\r\n    }\r\n  };\r\n\r\n  checkSeats = (indexArr, seats, numberOfTickets) => {\r\n    for (let i = indexArr[0]; i < indexArr[1]; i++) {\r\n      for (let j = 0; j <= seats[i].length - numberOfTickets; j++) {\r\n        if (seats[i].slice(j, j + numberOfTickets).every(seat => !seat)) {\r\n          return [i, j];\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  getSeat = (suggested, seats, numberOfTickets) => {\r\n    const { setSuggestedSeats } = this.props;\r\n    const seatsToSet = [];\r\n    for (let i = suggested[1]; i < suggested[1] + numberOfTickets; i++) {\r\n      seatsToSet.push([suggested[0], i]);\r\n    }\r\n    setSuggestedSeats(seatsToSet);\r\n  };\r\n\r\n  onChangeCinema = event => this.props.setSelectedCinema(event.target.value);\r\n  onChangeDate = date => this.props.setSelectedDate(date);\r\n  onChangeTime = event => this.props.setSelectedTime(event.target.value);\r\n\r\n  render() {\r\n    const {\r\n      classes,\r\n      user,\r\n      movie,\r\n      cinema,\r\n      showtimes,\r\n      selectedSeats,\r\n      selectedCinema,\r\n      selectedDate,\r\n      selectedTime,\r\n      showLoginPopup,\r\n      toggleLoginPopup,\r\n      showInvitation,\r\n      invitations,\r\n      setInvitation,\r\n      resetCheckout,\r\n      suggestedSeats,\r\n      suggestedSeat\r\n    } = this.props;\r\n    const { uniqueCinemas, uniqueTimes } = this.onFilterCinema();\r\n    let seats = this.onGetReservedSeats();\r\n    if (suggestedSeats && selectedTime && !suggestedSeat.length) {\r\n      this.onGetSuggestedSeats(seats, suggestedSeats);\r\n    }\r\n    if (suggestedSeat.length && !this.didSetSuggestion) {\r\n      suggestedSeat.forEach(([row, seat]) => {\r\n        if (seats[row]) seats[row][seat] = 3;\r\n      });\r\n      this.didSetSuggestion = true;\r\n    }\r\n    const seatsAvailable = seats.flat().filter(seat => seat === 0).length;\r\n\r\n    return (\r\n      <Container maxWidth=\"xl\" className={classes.container}>\r\n        <Grid container spacing={2} style={{ height: '100%' }}>\r\n          <MovieInfo movie={movie} />\r\n          <Grid item lg={9} xs={12} md={12}>\r\n            <BookingForm\r\n              cinemas={uniqueCinemas}\r\n              times={uniqueTimes}\r\n              showtimes={showtimes}\r\n              selectedCinema={selectedCinema}\r\n              selectedDate={selectedDate}\r\n              selectedTime={selectedTime}\r\n              onChangeCinema={this.onChangeCinema}\r\n              onChangeDate={this.onChangeDate}\r\n              onChangeTime={this.onChangeTime}\r\n            />\r\n            {showInvitation && !!selectedSeats.length && (\r\n              <BookingInvitation\r\n                selectedSeats={selectedSeats}\r\n                sendInvitations={this.sendInvitations}\r\n                ignore={resetCheckout}\r\n                invitations={invitations}\r\n                onSetInvitation={setInvitation}\r\n                onDownloadPDF={this.jsPdfGenerator}\r\n              />\r\n            )}\r\n            {cinema && selectedCinema && selectedTime && !showInvitation ? (\r\n              <>\r\n                <BookingSeats\r\n                  seats={seats}\r\n                  onSelectSeat={(indexRow, index) => this.onSelectSeat(indexRow, index)}\r\n                />\r\n                <BookingCheckout\r\n  user={user}\r\n  ticketPrice={cinema.ticketPrice}\r\n  seatsAvailable={seatsAvailable}\r\n  selectedSeats={selectedSeats.length}\r\n  onBookSeats={() => {\r\n    console.log('Checkout clicked');\r\n    this.checkout();\r\n  }}          \r\n                />\r\n              </>\r\n            ) : (\r\n              <Box textAlign=\"center\" color=\"white\" mt={2}>\r\n                Seats not available.\r\n              </Box>\r\n            )}\r\n          </Grid>\r\n        </Grid>\r\n        <ResponsiveDialog\r\n          id=\"Edit-cinema\"\r\n          open={showLoginPopup}\r\n          handleClose={() => toggleLoginPopup()}\r\n          maxWidth=\"sm\"\r\n        >\r\n          <LoginForm />\r\n        </ResponsiveDialog>\r\n      </Container>\r\n    );\r\n  }\r\n}\r\n\r\nBookingPage.propTypes = {\r\n  className: PropTypes.string,\r\n  classes: PropTypes.object.isRequired,\r\n  history: PropTypes.object.isRequired\r\n};\r\n\r\nconst mapStateToProps = (\r\n  {\r\n    authState,\r\n    movieState,\r\n    cinemaState,\r\n    showtimeState,\r\n    reservationState,\r\n    checkoutState\r\n  },\r\n  ownProps\r\n) => ({\r\n  isAuth: authState.isAuthenticated,\r\n  user: authState.user,\r\n  movie: movieState.selectedMovie,\r\n  cinema: cinemaState.selectedCinema,\r\n  cinemas: cinemaState.cinemas,\r\n  showtimes: showtimeState.showtimes.filter(\r\n    showtime => showtime.movieId === ownProps.match.params.id\r\n  ),\r\n  reservations: reservationState.reservations,\r\n  selectedSeats: checkoutState.selectedSeats,\r\n  suggestedSeat: checkoutState.suggestedSeat,\r\n  selectedCinema: checkoutState.selectedCinema,\r\n  selectedDate: checkoutState.selectedDate,\r\n  selectedTime: checkoutState.selectedTime,\r\n  showLoginPopup: checkoutState.showLoginPopup,\r\n  showInvitation: checkoutState.showInvitation,\r\n  invitations: checkoutState.invitations,\r\n  QRCode: checkoutState.QRCode,\r\n  suggestedSeats: reservationState.suggestedSeats\r\n});\r\n\r\nconst mapDispatchToProps = {\r\n  getMovie,\r\n  getCinema,\r\n  getCinemasUserModeling,\r\n  getCinemas,\r\n  getShowtimes,\r\n  getReservations,\r\n  getSuggestedReservationSeats,\r\n  addReservation,\r\n  setSelectedSeats,\r\n  setSuggestedSeats,\r\n  setSelectedCinema,\r\n  setSelectedDate,\r\n  setSelectedTime,\r\n  setInvitation,\r\n  toggleLoginPopup,\r\n  showInvitationForm,\r\n  resetCheckout,\r\n  setAlert,\r\n  setQRCode\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(BookingPage));\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}